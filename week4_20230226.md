# Kotlin in Action ìŠ¤í„°ë”” 4ì£¼ì°¨ ğŸ”¥
### 2023-02-26(ì¼)

---



## 7. ì—°ì‚°ì ì˜¤ë²„ë¡œë”©ê³¼ ê¸°íƒ€ ê´€ë¡€

ì—°ì‚°ìë¥¼ ì˜¤ë²„ë¡œë”© í•˜ëŠ” í•¨ìˆ˜ ì•ì—ëŠ” ê¼­ `operator` í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ì£¼ì–´ì•¼ í•œë‹¤. í‚¤ì›Œë“œë¥¼ ë¶™ì„ìœ¼ë¡œ ì¨ ì–´ë–¤ í•¨ìˆ˜ê°€ ê´€ë¡€ë¥¼ í•¨ìˆ˜ì„ì„ ëª…í™•íˆ í•  ìˆ˜ ìˆë‹¤.

ì´ í‚¤ì›Œë“œë¥¼ í™œìš©í•˜ì—¬ ì‚°ìˆ  ì—°ì‚°ìë¥¼ ì˜¤ë²„ë¡œë”©í•˜ê±°ë‚˜ ë¹„êµ ì—°ì‚°ìë¥¼ ì˜¤ë²„ë¡œë”© ê·¸ë¦¬ê³  ì»¬ë ‰ì…˜ì˜ ë²”ìœ„ì— ëŒ€í•´ ì—°ì‚°ì„ ì§€ì›í•  ìˆ˜ ìˆë‹¤.

### êµ¬ì¡° ë¶„í•´ ì„ ì–¸
êµ¬ì¡° ë¶„í•´ ì„ ì–¸ì„ ì‚¬ìš©í•˜ë©´ ë³µí•©ì ì¸ ê°’ì„ ë¶„í•´í•´ì„œ ì—¬ëŸ¬ ë‹¤ë¥¸ ë³€ìˆ˜ë¥¼ í•œêº¼ë²ˆì— ì´ˆê¸°í™” í•  ìˆ˜ ìˆë‹¤.
```kotlin
>>> val p = Point(10, 20)
>>> val (x, y) = p
>>> println(x)
10
```

ë‚´ë¶€ì—ì„œ êµ¬ì¡° ë¶„í•´ ì„ ì–¸ì€ ê° ë³€ìˆ˜ë¥¼ ì´ˆê¸°í™” í•˜ê¸° ìœ„í•´ `componentN`ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

Nì€ êµ¬ì¡° ë¶„í•´ ì„ ì–¸ì´ ìˆëŠ” ë³€ìˆ˜ ìœ„ì¹˜ì— ë”°ë¼ ë¶™ëŠ” ë²ˆí˜¸ê°€ ëœë‹¤.

```kotlin
val (x, y) = p  -> val x = p.component1(), val y = p.component2()
```

ì˜ˆì‹œë¡œ íŒŒì¼ ì´ë¦„ì„ ì´ë¦„ê³¼ í™•ì¥ìë¡œ ë‚˜ëˆ„ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ë³´ì.

```kotlin
data class NameComponents(val name: String, val extension: String)

fun splitFilename(fullName: String): NameComponents {
    val result = fullName.split('.', limit = 2)
    return NameComponents(result[0], result[1])
}
```
ìœ„ ì˜ˆì œë¥¼ ì•ì„œë§í•œ `componentN` í•¨ìˆ˜ë¥¼ ì ìš©í•˜ì—¬ ê°œì„ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë¦¬íŒ©í† ë§í•  ìˆ˜ ìˆë‹¤.

```kotlin
data class NameComponents(val name: String, val extension: String)

fun splitFilename(fullName: String): NameComponents {
    
    val (name, extension) = fullName.split('.', limit = 2)
    return NameComponents(name, extension)
}
```

ë§µ ìë£Œí˜•ì„ ì´í„°ë ˆì´ì…˜í•  ë•Œì—ë„ êµ¬ì¡° ë¶„í•´ ì„ ì–¸ì€ ìœ ìš©í•˜ë‹¤.
```kotlin
fun printEntries(map: Map<String, String>){
    for((key, value) in map){
        println("$key -> $value")
    }
}
```

---

### í”„ë¡œí¼í‹° ì ‘ê·¼ì ë¡œì§ ì¬í™œìš©: ìœ„ì„ í”„ë¡œí¼í‹°

í”„ë¡œí¼í‹° ìœ„ì„ì„ ì‚¬ìš©í•´ ìì‹ ì˜ ê°’ì„ í•„ë“œê°€ ì•„ë‹ˆë¼ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì´ë‚˜ ë¸Œë¼ì´ì € ì„¸ì…˜, ë§µ ë“±ì— ì €ì¥í•  ìˆ˜ ìˆë‹¤.

ìœ„ì„ì„ í†µí•´ ê°ì²´ê°€ ì§ì ‘ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ë„ìš°ë¯¸ ê°ì²´ê°€ ê·¸ ì‘ì—…ì„ ì²˜ë¦¬í•˜ê²Œ ë§¡ê¸°ëŠ” ë””ìì¸ íŒ¨í„´ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

ì´ë•Œ ë„ìš°ë¯¸ ê°ì²´ë¥¼ ìœ„ì„ ê°ì²´(delegate)ë¼ê³  ë¶€ë¥¸ë‹¤.

ìœ„ì„ í”„ë¡œí¼í‹°ì˜ ì¼ë°˜ì ì¸ ë¬¸ë²•

```kotlin

import kotlin.properties.Delegates

class Foo {
    var p: Type by Delegates()
}
```
í”„ë¡œí¼í‹° ìœ„ì„ ê°ì²´ê°€ ë”°ë¼ì•¼ í•˜ëŠ” ê´€ë¡€ë¥¼ ë”°ë¥´ëŠ” ëª¨ë“  ê°ì²´ë¥¼ ìœ„ì„ì— ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```kotlin

import kotlin.properties.Delegates

class Foo {
    private val delegate = Delegates() // ì»´íŒŒì¼ëŸ¬ê°€ ìƒì„±í•œ ë„ìš°ë¯¸ í”„ë¡œí¼í‹°
    var p = Type
        set(value: Type) = delegate.setValue(..., value)
        get() = delegate.getvalue(...)
}
```
í”„ë¡œí¼í‹° ìœ„ì„ ê´€ê³„ë¥¼ ë”°ë¥´ëŠ” Delegateí´ë˜ìŠ¤ëŠ” get, set ë©”ì„œë“œë¥¼ ì œê³µí•´ì•¼ í•œë‹¤. Delegate í´ë˜ìŠ¤ë¥¼ ë‹¨ìˆœí™”í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```kotlin
class Delegate {
    operator fun getValue(){}
    operator fun setValue(){}
}

class Foo {
    var p: Type by Delegate()
}

>>> val foo = Foo()
>>> val oldValue = foo.p
>>> foo.p = newVaule
```

--- 

ì§€ì—° ì´ˆê¸°í™”ëŠ” ê°ì²´ì˜ ì¼ë¶€ë¶„ì„ ì´ˆê¸°í™”í•˜ì§€ ì•Šê³  ë‚¨ê²¨ë’€ë‹¤ê°€ ì‹¤ì œë¡œ ê·¸ ë¶€ë¶„ì˜ ê°’ì´ í•„ìš”í•  ê²½ìš° ì´ˆê¸°í™”í•  ë•Œ í”íˆ ì“°ì¸ë‹¤.

## 8. ê³ ì°¨ í•¨ìˆ˜: íŒŒë¼ë¯¸í„°ì™€ ë°˜í™˜ ê°’ìœ¼ë¡œ ëŒë‹¤ ì‚¬ìš©

### ê³ ì°¨í•¨ìˆ˜ë€?

ê³ ì°¨ í•¨ìˆ˜ë€ ë‹¤ë¥¸ í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ê±°ë‚˜ í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. ì½”í‹€ë¦°ì—ì„œëŠ” ëŒë‹¤ë‚˜ í•¨ìˆ˜ ì°¸ì¡°ë¥¼ í†µí•´ í•¨ìˆ˜ë¥¼ ê°’ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ê³ ì°¨ í•¨ìˆ˜ëŠ” ëŒë‹¤ë‚˜ í•¨ìˆ˜ ì°¸ì¡°ë¥¼ ì¸ìë¡œ ë„˜ê¸¸ ìˆ˜ ìˆê±°ë‚˜ ëŒë‹¤ë‚˜ í•¨ìˆ˜ ì°¸ì¡°ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì´ë©° í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ëŠ” ë™ì‹œì— í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë„ ê³ ì°¨í•¨ìˆ˜ë¼ê³  í•  ìˆ˜ ìˆë‹¤.

ìš”ì•½í•˜ìë©´ ê³ ì°¨ í•¨ìˆ˜ëŠ” í•¨ìˆ˜ë¥¼ í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì„ ìˆ˜ ìˆê³ , í•¨ìˆ˜ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë¥¼ ë§í•œë‹¤.

ë‹¨ìˆœí•œ ì˜ˆì‹œë¡œ `filter`, `map`, `with` ê°€ ìˆë‹¤.

ì½”í‹€ë¦°ì€ í•¨ìˆ˜ íƒ€ì…ì„ ê°€ì§„ë‹¤. ì´ê²ƒì€ ì •ìˆ˜ íƒ€ì…, ì‹¤ìˆ˜ íƒ€ì…ê³¼ ê°™ì€ íƒ€ì…ì„ ë§í•˜ë©° í•¨ìˆ˜ íƒ€ì…ì€ (Int) -> String ê³¼ ê°™ì´ ì“°ì—¬ì§ˆ ìˆ˜ ìˆë‹¤.

í•¨ìˆ˜ íƒ€ì… ë¬¸ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

`(Int, String) -> Unit`

ì´ë•Œ Unitì€ ìƒëµë  ìˆ˜ ì—†ë‹¤. ê·¸ëƒ¥ í•¨ìˆ˜ íƒ€ì…ì´ë¼ë©´ Unit ë°˜í™˜ íƒ€ì…ì„ ìƒëµí•  ìˆ˜ ìˆì§€ë§Œ í•¨ìˆ˜ íƒ€ì…ì„ ì„ ì–¸í•  ë•Œì—” ë°˜ë“œì‹œ ëª…ì‹œí•´ ì£¼ì–´ì•¼ í•œë‹¤.

```kotlin
val canReturnNull: (Int, Int) -> Int? = {x, y -> null} // ë°˜í™˜ ê°’ì´ null
val funOrNull: ((Int, Int) -> Int)? = null // í•¨ìˆ˜ íƒ€ì… ì „ì²´ê°€ null
```

ê°„ë‹¨í•œ ê³ ì°¨ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```kotlin
fun twoAndThree(operation: (Int, Int) -> Int){ // í•¨ìˆ˜ íƒ€ì…ì¸ íŒŒë¼ë¯¸í„°ë¥¼ ì„ ì–¸
    val result = operation(2, 3) // í•¨ìˆ˜ íƒ€ì…ì¸ íŒŒë¼ë¯¸í„° í˜¸ì¶œ
    println("The result is $result")
}

>>> twoAndThree { a, b -> a + b}
```

ìë°”ì—ì„œ ì½”í‹€ë¦°ì˜ ëŒë‹¤ë¥¼ ì¸ìë¡œ ë°›ëŠ” í™•ì¥í•¨ìˆ˜ë¥¼ í˜¸ì¶œ í•  ìˆ˜ ìˆì§€ë§Œ ì½”í‹€ë¦°ì—ì„œ í˜¸ì¶œí•  ë•Œì²˜ëŸ¼ ì½”ë“œê°€ ê¹”ë”í•˜ì§€ ì•Šë‹¤.

```java
CollectionsKt.forEach(string, s -> {
    System.out.println(s);
    return Unit.Instance;
})
```
ë°˜í™˜ íƒ€ì…ì´ Unitì¸ í•¨ìˆ˜ë‚˜ ëŒë‹¤ë¥¼ ìë°”ë¡œ ì‘ì„±í•  ìˆ˜ ìˆì§€ë§Œ ìë°”ì—ì„œëŠ” ê·¸ ê°’ì„ ëª…ì‹œì ìœ¼ë¡œ ë°˜í™˜í•´ì¤˜ì•¼í•œë‹¤.

```kotlin
// in Kotlin
login(countryCode, account, password){ result, user, errorMessage ->
    if(result){ 
        // todo
    } else {
        // todo
    }
}
```

```java
// in Java
login(countryCode, account, password, (result, user, errorMessage) -> {
    if (result) {
        // todo
    } else {
        // todo
    }
    return null;
});
```

í•¨ìˆ˜ íƒ€ì… íŒŒë¼ë¯¸í„°ë¥¼ ì„ ì–¸í•˜ì—¬ ëŒë‹¤ë¥¼ ì¸ìë¡œ ì „ë‹¬ í•  ìˆ˜ ìˆë‹¤.

```kotlin
public fun <T> Iterable<T>.joinToString(
        separator: CharSequence = ", ", 
        prefix: CharSequence = "", 
        postfix: CharSequence = "", 
        limit: Int = -1, 
        truncated: CharSequence = "...", 
        transform: ((T) -> CharSequence)? = null)
: String {
    return joinTo(StringBuilder(), separator, prefix, postfix, limit, truncated, transform).toString()
}

>>> val letters = listOf("Alpha", "Beta")
>>> println(letters.joinToString())
Alpha, Beta
>>> println(letters.joinToString() { it.toLowerCase()})
alpha, beta 
```

Collection í´ë˜ìŠ¤ì˜ ë‚´ë¶€ë¥¼ ë“¤ì—¬ë‹¤ë³´ë‹ˆ
```kotlin
public fun <T, A : Appendable> Iterable<T>.joinTo(buffer: A, separator: CharSequence = ", ", prefix: CharSequence = "", postfix: CharSequence = "", limit: Int = -1, truncated: CharSequence = "...", transform: ((T) -> CharSequence)? = null): A {
    buffer.append(prefix)
    var count = 0
    for (element in this) {
        if (++count > 1) buffer.append(separator)
        if (limit < 0 || count <= limit) {
            buffer.appendElement(element, transform)
        } else break
    }
    if (limit >= 0 && count > limit) buffer.append(truncated)
    buffer.append(postfix)
    return buffer
}
```

```kotlin
// Appendable.kt
internal fun <T> Appendable.appendElement(element: T, transform: ((T) -> CharSequence)?) {
    when {
        transform != null -> append(transform(element))
        element is CharSequence? -> append(element)
        element is Char -> append(element)
        else -> append(element.toString())
    }
}
```
ê¸°ë³¸ ê°’ìœ¼ë¡œ toStringì´ êµ¬í˜„ë˜ì–´ ìˆëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆì—ˆë‹¤.